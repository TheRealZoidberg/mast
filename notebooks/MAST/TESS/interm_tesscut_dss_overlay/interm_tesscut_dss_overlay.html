
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Intermediate: Overlay a Cutout of the TESS FFIs with DSS imaging &#8212; MAST repository template</title>
    
  <!-- Loaded before other Sphinx assets -->
  <link href="../../../../_static/styles/theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
<link href="../../../../_static/styles/pydata-sphinx-theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../../../../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../../../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../../../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    <link rel="stylesheet" type="text/css" href="../../../../_static/pygments.css" />
    <link rel="stylesheet" href="../../../../_static/styles/sphinx-book-theme.css?digest=5115cc725059bd94278eecd172e13a965bf8f5a9" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../../../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../../../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../../../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../../../../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../../../../_static/main.css" />
    <link rel="stylesheet" type="text/css" href="../../../../_static/design-style.b7bb847fb20b106c3d81b95245e65545.min.css" />
    
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../../../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf">

    <script data-url_root="../../../../" id="documentation_options" src="../../../../_static/documentation_options.js"></script>
    <script src="../../../../_static/jquery.js"></script>
    <script src="../../../../_static/underscore.js"></script>
    <script src="../../../../_static/doctools.js"></script>
    <script src="../../../../_static/clipboard.min.js"></script>
    <script src="../../../../_static/copybutton.js"></script>
    <script src="../../../../_static/scripts/sphinx-book-theme.js?digest=9c920249402e914e316237a7dbc6769907cce411"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../../../../_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../../../../_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../../../../_static/sphinx-thebe.js"></script>
    <link rel="index" title="Index" href="../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../search.html" />
    <link rel="next" title="Intermediate: Retrieve TESS Pixel Response Function Images" href="../interm_tess_prf_retrieve/interm_tess_prf_retrieve.html" />
    <link rel="prev" title="Download MAST TESS Light Curves Within an FFI Footprint Using TAP" href="../beginner_tess_tap_search/beginner_tess_tap_search.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="60">
<!-- Checkboxes to toggle the left sidebar -->
<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation" aria-label="Toggle navigation sidebar">
<label class="overlay overlay-navbar" for="__navigation">
    <div class="visually-hidden">Toggle navigation sidebar</div>
</label>
<!-- Checkboxes to toggle the in-page toc -->
<input type="checkbox" class="sidebar-toggle" name="__page-toc" id="__page-toc" aria-label="Toggle in-page Table of Contents">
<label class="overlay overlay-pagetoc" for="__page-toc">
    <div class="visually-hidden">Toggle in-page Table of Contents</div>
</label>
<!-- Headers at the top -->
<div class="announcement header-item noprint"></div>
<div class="header header-item noprint"></div>

    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<!-- Sidebar -->
<div class="bd-sidebar noprint" id="site-navigation">
    <div class="bd-sidebar__content">
        <div class="bd-sidebar__top"><div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../../../../index.html">
      
        <!-- `logo` is deprecated in Sphinx 4.0, so remove this when we stop supporting 3 -->
        
      
      
      <img src="../../../../_static/logo.png" class="logo" alt="logo">
      
      
      <h1 class="site-logo" id="site-title">MAST repository template</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../../../../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../../../../intro.html">
                    Welcome to your Jupyter Book
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Astroquery
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../astroquery/large_downloads/large_downloads.html">
   Large Downloads in
   <code class="docutils literal notranslate">
    <span class="pre">
     astroquery.mast
    </span>
   </code>
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../astroquery/beginner_search_astroquery/beginner_search_astroquery.html">
   Beginner: Searching MAST using astroquery.mast
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  TESS
 </span>
</p>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../interm_tesscut_requests/interm_tesscut_requests.html">
   Intermediate: Create TESS FFI Cutout using Python Requests
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../beginner_tour_lc_tp/beginner_tour_lc_tp.html">
   Beginnner: A Tour of the Contents of the TESS 2-minute Cadence Data
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../beginner_tic_search_hd209458/beginner_tic_search_hd209458.html">
   Beginner: Search The TESS Input Catalog Centered On HD 209458.
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../beginner_how_to_use_lc/beginner_how_to_use_lc.html">
   Beginner: Read and Plot A TESS Light Curve File
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../interm_gi_query/interm_gi_query.html">
   Intermediate:  Search and Download GI Program Light Curves
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../beginner_how_to_use_tp/beginner_how_to_use_tp.html">
   Beginner: Read and Display A TESS Target Pixel File
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../interm_tesscut_astroquery/interm_tesscut_astroquery.html">
   Beginner: Cutout of the TESS FFIs using Astrocut and Astroquery
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../beginner_tess_exomast/beginner_tess_exomast.html">
   Exoplanet Data and TESS Light Curves Using Python Requests
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../beginner_how_to_use_dvt/beginner_how_to_use_dvt.html">
   Beginner: Read and Plot A TESS Data Validation Timeseries File
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../beginner_astroquery_dv/beginner_astroquery_dv.html">
   Beginner: Retrieve TESS Data Validation Products with Astroquery
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../interm_tasc_lc/interm_tasc_lc.html">
   Intermediate: Finding Flares and Variable Stars in TASC Light Curves
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../beginner_how_to_use_ffi/beginner_how_to_use_ffi.html">
   Beginner: Read and Display a TESS Full Frame Image
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../tess_removing_scattered_light_using_regression/tess_removing_scattered_light_using_regression.html">
   Removing Scattered Light from
   <em>
    TESS
   </em>
   Data Using the Lightkurve
   <code class="docutils literal notranslate">
    <span class="pre">
     RegressionCorrector
    </span>
   </code>
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../beginner_tess_tap_search/beginner_tess_tap_search.html">
   Download MAST TESS Light Curves Within an FFI Footprint Using TAP
  </a>
 </li>
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   Intermediate: Overlay a Cutout of the TESS FFIs with DSS imaging
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../interm_tess_prf_retrieve/interm_tess_prf_retrieve.html">
   Intermediate: Retrieve TESS Pixel Response Function Images
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Kepler K2
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../K2/K2_TPF/K2_TPF.html">
   Beginner: Read and Display A K2 Target Pixel File
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../K2/k2_removing_instrumental_noise_using_pld/k2_removing_instrumental_noise_using_pld.html">
   Removing Instrumental Noise from
   <em>
    K2
   </em>
   and
   <em>
    TESS
   </em>
   Light Curves Using Pixel Level Decorrelation (PLD)
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../K2/K2_Lightcurve/K2_Lightcurve.html">
   Beginner: Read and Plot A K2 Light Curve File
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../K2/beginner_how_to_use_ffi/beginner_how_to_use_ffi.html">
   Beginner: Read and Display a K2 Full Frame Image
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Kepler
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../Kepler/kepler_creating_periodograms/kepler_creating_periodograms.html">
   Creating Periodograms and Identifying Significant Peaks
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../Kepler/kepler_using_light_curve_products_with_lightkurve/kepler_using_light_curve_products_with_lightkurve.html">
   Using
   <em>
    Kepler
   </em>
   Light Curve Products with Lightkurve
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../Kepler/Kepler_FFI/kepler_ffi.html">
   Plotting a Catalog over a Kepler Full Frame Image File
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../Kepler/kepler_verifying_the_location_of_a_signal/kepler_verifying_the_location_of_a_signal.html">
   Verifying the Location of a Signal in
   <em>
    Kepler
   </em>
   Pixel Data
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../Kepler/Kepler_TPF/kepler_tpf.html">
   Plotting Images from Kepler Target Pixel Files
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../Kepler/kepler_how_to_estimate_a_stars_mass_and_radius_using_asteroseismology/kepler_how_to_estimate_a_stars_mass_and_radius_using_asteroseismology.html">
   How to Estimate a Star’s Mass and Radius Using Asteroseismology
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../Kepler/kepler_instrumental_noise_1_data_gaps_and_quality_flags/kepler_instrumental_noise_1_data_gaps_and_quality_flags.html">
   Instrumental Noise in
   <em>
    Kepler
   </em>
   and
   <em>
    K2
   </em>
   #1: Data Gaps and Quality Flags
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../Kepler/kepler_instrumental_noise_4_electronic_noise/kepler_instrumental_noise_4_electronic_noise.html">
   Instrumental Noise in
   <em>
    Kepler
   </em>
   and
   <em>
    K2
   </em>
   #4: Electronic Noise
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../Kepler/kepler_identifying_transiting_planet_signals/kepler_identifying_transiting_planet_signals.html">
   Identifying Transiting Planet Signals in a
   <em>
    Kepler
   </em>
   Light Curve
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../Kepler/Kepler_DVT/Kepler_DVT.html">
   Read and Plot A Kepler Data Validation Timeseries File
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../Kepler/kepler_instrumental_noise_2_spurious_signals_and_time_sampling_effects/kepler_instrumental_noise_2_spurious_signals_and_time_sampling_effects.html">
   Instrumental Noise in
   <em>
    Kepler
   </em>
   and
   <em>
    K2
   </em>
   #2: Spurious Signals and Time Sampling Effects
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../Kepler/Kepler_Lightcurve/kepler_lightcurve.html">
   Using Kepler Data to Plot a Light Curve
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../Kepler/kepler_instrumental_noise_3_seasonal_and_detector_effects/kepler_instrumental_noise_3_seasonal_and_detector_effects.html">
   Instrumental Noise in
   <em>
    Kepler
   </em>
   and
   <em>
    K2
   </em>
   #3: Seasonal and Detector Effects
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../Kepler/kepler_combining_multiple_quarters/kepler_combining_multiple_quarters.html">
   Combining Multiple Quarters of
   <em>
    Kepler
   </em>
   Data with Lightkurve
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../Kepler/kepler_measuring_a_rotation_period/kepler_measuring_a_rotation_period.html">
   Measuring and Removing a Rotation Period Signal from a
   <em>
    Kepler
   </em>
   Light Curve
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../Kepler/kepler_interactively_inspecting_target_pixel_files_and_light_curves/kepler_interactively_inspecting_target_pixel_files_and_light_curves.html">
   Interactively Inspecting Target Pixel Files and Light Curves
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../Kepler/kepler_plotting_target_pixel_files/kepler_plotting_target_pixel_files.html">
   Plotting
   <em>
    Kepler
   </em>
   Target Pixel File Products with Lightkurve
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../Kepler/kepler_using_target_pixel_file_products_with_lightkurve/kepler_using_target_pixel_file_products_with_lightkurve.html">
   Using
   <em>
    Kepler
   </em>
   Target Pixel File Products with Lightkurve
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../Kepler/kepler_searching_for_data_products/kepler_searching_for_data_products.html">
   Searching for
   <em>
    Kepler
   </em>
   /
   <em>
    K2
   </em>
   and
   <em>
    TESS
   </em>
   Data Products Using Lightkurve
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../Kepler/kepler_visualizing_periodic_signals_using_a_river_plot/kepler_visualizing_periodic_signals_using_a_river_plot.html">
   Visualizing Periodic Signals Using a River Plot
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../Kepler/kepler_how_to_understand_and_manipulate_the_periodogram_of_an_oscillating_star/kepler_how_to_understand_and_manipulate_the_periodogram_of_an_oscillating_star.html">
   How to Understand and Manipulate the Periodogram of an Oscillating Star
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../Kepler/kepler_creating_your_own_light_curves/kepler_creating_your_own_light_curves.html">
   Creating Your Own Light Curves using Custom Aperture Photometry
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  HSC
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../HSC/HSCV3_API/hscv3_api.html">
   Hubble Source Catalog API Notebook
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../HSC/HCV_CASJOBS/HCV_casjobs_demo.html">
   Hubble Catalog of Variables Notebook (CasJobs version)
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../HSC/HSC_TAP/HSC_TAP.html">
   MAST Table Access Protocol Hubble Source Catalog Demo
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../HSC/SWEEPS_HSCV3P1_API/sweeps_hscv3p1_api.html">
   Hubble Source Catalog SWEEPS Proper Motion Notebook
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../HSC/HSCV3_SMC_API/hscv3_smc_api.html">
   Hubble Source Catalog API Notebook: SMC Color-Magnitude Diagram
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../HSC/HCV_API/HCV_API_demo.html">
   Hubble Catalog of Variables Notebook (API version)
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../HSC/SWEEPS_HSCV3P1/sweeps_hscv3p1.html">
   Hubble Source Catalog SWEEPS Proper Motion Notebook
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  PanSTARRS
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../PanSTARRS/PS1_DR2_TAP/PS1_DR2_TAP.html">
   MAST Table Access Protocol PanSTARRS 1 DR2 Demo
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  JWST
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../JWST/Engineering_Database_Retreival/EDB_Retrieval.html">
   JWST Engineering Data Retrieval
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../JWST/download_by_program_id/download_by_program_id.html">
   Accessing JWST Proposal Data in astroquery.mast
  </a>
 </li>
</ul>

    </div>
</nav></div>
        <div class="bd-sidebar__bottom">
             <!-- To handle the deprecated key -->
            
            <div class="navbar_extra_footer">
            Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
            </div>
            
        </div>
    </div>
    <div id="rtd-footer-container"></div>
</div>


          


          
<!-- A tiny helper pixel to detect if we've scrolled -->
<div class="sbt-scroll-pixel-helper"></div>
<!-- Main content -->
<div class="col py-0 content-container">
    
    <div class="header-article row sticky-top noprint">
        



<div class="col py-1 d-flex header-article-main">
    <div class="header-article__left">
        
        <label for="__navigation"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="right"
title="Toggle navigation"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-bars"></i>
  </span>

</label>

        
    </div>
    <div class="header-article__right">
<button onclick="toggleFullScreen()"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="bottom"
title="Fullscreen mode"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>

<div class="menu-dropdown menu-dropdown-repository-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Source repositories">
      <i class="fab fa-github"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="(CHANGE THIS)"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Source repository"
>
  

<span class="headerbtn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="headerbtn__text-container">repository</span>
</a>

      </li>
      
      <li>
        <a href="(CHANGE THIS)/issues/new?title=Issue%20on%20page%20%2Fnotebooks/MAST/TESS/interm_tesscut_dss_overlay/interm_tesscut_dss_overlay.html&body=Your%20issue%20content%20here."
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Open an issue"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="headerbtn__text-container">open issue</span>
</a>

      </li>
      
    </ul>
  </div>
</div>

<div class="menu-dropdown menu-dropdown-download-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Download this page">
      <i class="fas fa-download"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="../../../../_sources/notebooks/MAST/TESS/interm_tesscut_dss_overlay/interm_tesscut_dss_overlay.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Download source file"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="headerbtn__text-container">.ipynb</span>
</a>

      </li>
      
      <li>
        
<button onclick="printPdf(this)"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="left"
title="Print to PDF"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="headerbtn__text-container">.pdf</span>
</button>

      </li>
      
    </ul>
  </div>
</div>
<label for="__page-toc"
  class="headerbtn headerbtn-page-toc"
  
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-list"></i>
  </span>

</label>

    </div>
</div>

<!-- Table of contents -->
<div class="col-md-3 bd-toc show noprint">
    <div class="tocsection onthispage pt-5 pb-3">
        <i class="fas fa-list"></i> Contents
    </div>
    <nav id="bd-toc-nav" aria-label="Page">
        <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#table-of-contents">
   Table of Contents
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#tesscut-overlay-with-dss">
   TESSCut Overlay with DSS
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#import-statements">
   Import Statements
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#getting-a-custom-tess-cutout-target-pixel-file">
   Getting a Custom TESS Cutout Target Pixel File
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#use-astroquery-to-retrieve-the-tesscut-image">
     Use Astroquery to retrieve the TESSCut image
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#open-a-target-pixel-file">
     Open a Target Pixel File
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#create-and-display-a-gif-of-the-custom-tpf">
     Create and display a GIF of the custom TPF
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#find-targets-within-tpf-fov-in-tess-input-catalog">
     Find targets within TPF FOV in TESS Input Catalog
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#plot-static-tpf-image-and-overlay-tic-catalog">
     Plot static TPF image and overlay TIC catalog
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#retrieve-the-dss-image-of-the-region">
   Retrieve the DSS image of the region
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#overlay-the-tesscut-image">
   Overlay the TessCut Image
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#additional-resources">
   Additional Resources
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#about-this-notebook">
   About this Notebook
  </a>
 </li>
</ul>

    </nav>
</div>
    </div>
    <div class="article row">
        <div class="col pl-md-3 pl-lg-5 content-container">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>Intermediate: Overlay a Cutout of the TESS FFIs with DSS imaging</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Contents </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#table-of-contents">
   Table of Contents
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#tesscut-overlay-with-dss">
   TESSCut Overlay with DSS
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#import-statements">
   Import Statements
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#getting-a-custom-tess-cutout-target-pixel-file">
   Getting a Custom TESS Cutout Target Pixel File
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#use-astroquery-to-retrieve-the-tesscut-image">
     Use Astroquery to retrieve the TESSCut image
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#open-a-target-pixel-file">
     Open a Target Pixel File
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#create-and-display-a-gif-of-the-custom-tpf">
     Create and display a GIF of the custom TPF
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#find-targets-within-tpf-fov-in-tess-input-catalog">
     Find targets within TPF FOV in TESS Input Catalog
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#plot-static-tpf-image-and-overlay-tic-catalog">
     Plot static TPF image and overlay TIC catalog
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#retrieve-the-dss-image-of-the-region">
   Retrieve the DSS image of the region
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#overlay-the-tesscut-image">
   Overlay the TessCut Image
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#additional-resources">
   Additional Resources
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#about-this-notebook">
   About this Notebook
  </a>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            <main id="main-content" role="main">
                
              <div>
                
  <p><a id="title_ID"></a></p>
<section class="tex2jax_ignore mathjax_ignore" id="intermediate-overlay-a-cutout-of-the-tess-ffis-with-dss-imaging">
<h1>Intermediate: Overlay a Cutout of the TESS FFIs with DSS imaging<a class="headerlink" href="#intermediate-overlay-a-cutout-of-the-tess-ffis-with-dss-imaging" title="Permalink to this headline">#</a></h1>
<p>This notebook shows the user how to use the MAST programmatic interface to create a cutout of the small section of the TESS FFIs. For this example we will determine the RA and Dec for TIC 261105201. We then perform a query to determine which sectors contain this RA and Dec, peform a cutout of the FFI time series, open the resulting target pixel files, and plot the first image of each file with the WCS overlayed on the image. Finally we will create a light curve from the resulting image by creating a photometric aperture and summing the light in our pixels.</p>
<p>This tutorial shows the users how to do the following: use <code class="docutils literal notranslate"><span class="pre">astroquery.catalogs</span></code> to query the TIC, use astroquery Tesscut to determine the number of sectors that contain our target and download a FFI cutout.</p>
<section id="table-of-contents">
<h2>Table of Contents<a class="headerlink" href="#table-of-contents" title="Permalink to this headline">#</a></h2>
<p><a class="reference external" href="#get_tesscut">Get Tesscut with Astroquery</a> <br></p>
<ul class="simple">
<li><p><a class="reference external" href="#download_tess">Download Tesscut</a><br></p></li>
<li><p><a class="reference external" href="#make_tpf">Make Kepler TPF</a><br></p></li>
<li><p><a class="reference external" href="#make_gif">Make GIF</a><br></p></li>
<li><p><a class="reference external" href="#find_tic">Find TIC objects</a><br></p></li>
<li><p><a class="reference external" href="#plot_tpf_tic">Overlay TessCut and TIC</a><br></p></li>
</ul>
<p><a class="reference external" href="#get_dss">Get DSS image</a> <br>
<a class="reference external" href="#overlay_images">Overlay Tesscut and DSS</a> <br>
<a class="reference external" href="#resources">Additional Resources</a> <br>
<a class="reference external" href="#about_ID">About this Notebook</a></p>
</section>
<section id="tesscut-overlay-with-dss">
<h2>TESSCut Overlay with DSS<a class="headerlink" href="#tesscut-overlay-with-dss" title="Permalink to this headline">#</a></h2>
<p>This notebook is an example of accessing and displaying a TESS FFI Cutout using the MAST TessCut service built into astroquery.  It uses astroquery to retrieve the related objects from the Tess Input Catalog (TIC). We then grab the related DSS image and overlay the TIC objects and the TESSCut image altogether.</p>
<p>This notebook uses several base packages but requires the following additional packages:</p>
<ul class="simple">
<li><p>astropy</p></li>
<li><p>astroquery &gt; 0.3.9</p></li>
<li><p>k2flix</p></li>
<li><p>ipython &gt; 7.2</p></li>
<li><p>ipywidgets &gt; 7.4.2</p></li>
<li><p>reproject</p></li>
</ul>
</section>
<section id="import-statements">
<h2>Import Statements<a class="headerlink" href="#import-statements" title="Permalink to this headline">#</a></h2>
<p><a id="imports_ID"></a></p>
<p>We start with a few import statements.</p>
<ul class="simple">
<li><p><em>os</em> to handle path and file operations</p></li>
<li><p><em>requests</em> to handle HTTP get requests</p></li>
<li><p><em>numpy</em> to handle array functions</p></li>
<li><p><em>matplotlib.pyplot</em> for plotting the data</p></li>
<li><p><em>k2flix</em> to load and create a Target Pixel File object and make GIFs</p></li>
<li><p><em>astroquery.mast</em> for the Catalogs and for Tesscut.</p></li>
<li><p><em>astropy.units</em> for using proper astronomy units</p></li>
<li><p><em><a class="reference external" href="http://astropy.io">astropy.io</a> fits</em> for accessing FITS files</p></li>
<li><p><em>astropy.wcs WCS</em> to interpret the World Coordinate Systems</p></li>
<li><p><em>astropy.coordinates SkyCoord</em> for creating an on-sky coordinate</p></li>
<li><p><em>astropy.visualizaton simple_norm</em> for normalizing data for plots</p></li>
<li><p><em>reproject reproject_interp</em> for reprojecting images from one WCS coordinate system into another</p></li>
<li><p><em>IPython.display Image</em> for loading a GIF image in the notebook</p></li>
<li><p><em>ipywidgets</em> to create an interactive plot with widget slider</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># import the packages we need</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">requests</span>
<span class="kn">import</span> <span class="nn">k2flix</span>
<span class="o">%</span><span class="k">matplotlib</span> inline
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="c1"># astroquery</span>
<span class="kn">from</span> <span class="nn">astroquery.mast</span> <span class="kn">import</span> <span class="n">Tesscut</span>
<span class="kn">from</span> <span class="nn">astroquery.mast</span> <span class="kn">import</span> <span class="n">Catalogs</span>

<span class="c1"># Astropy</span>
<span class="kn">import</span> <span class="nn">astropy.units</span> <span class="k">as</span> <span class="nn">u</span>
<span class="kn">from</span> <span class="nn">astropy.io</span> <span class="kn">import</span> <span class="n">fits</span>
<span class="kn">from</span> <span class="nn">astropy.wcs</span> <span class="kn">import</span> <span class="n">WCS</span>
<span class="kn">from</span> <span class="nn">astropy.coordinates</span> <span class="kn">import</span> <span class="n">SkyCoord</span>
<span class="kn">from</span> <span class="nn">astropy.visualization</span> <span class="kn">import</span> <span class="n">simple_norm</span>

<span class="kn">from</span> <span class="nn">reproject</span> <span class="kn">import</span> <span class="n">reproject_interp</span>

<span class="kn">from</span> <span class="nn">IPython.display</span> <span class="kn">import</span> <span class="n">Image</span>
<span class="kn">from</span> <span class="nn">ipywidgets</span> <span class="kn">import</span> <span class="n">interact</span><span class="p">,</span> <span class="n">interactive</span><span class="p">,</span> <span class="n">fixed</span><span class="p">,</span> <span class="n">interact_manual</span>
</pre></div>
</div>
</div>
</div>
<p><a id="get_tesscut"></a></p>
</section>
<section id="getting-a-custom-tess-cutout-target-pixel-file">
<h2>Getting a Custom TESS Cutout Target Pixel File<a class="headerlink" href="#getting-a-custom-tess-cutout-target-pixel-file" title="Permalink to this headline">#</a></h2>
<p>The first step is to get the Target Pixel File.  We can download a custom target pixel file using the <strong>Astroquery</strong> python package. In particular we will use the <code class="docutils literal notranslate"><span class="pre">download_tesscut</span></code> method from the <a class="reference external" href="https://astroquery.readthedocs.io/en/latest/mast/mast.html#tesscut">Tesscut</a> module.  Let’s create a Tess cutout centered on RA, Dec = 66.582618, -67.806508 in a 11x11 pixel window.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># select a target and cutout size in pixels</span>
<span class="n">ra</span><span class="p">,</span> <span class="n">dec</span> <span class="o">=</span> <span class="mf">66.582618</span><span class="p">,</span> <span class="o">-</span><span class="mf">67.806508</span>
<span class="n">target</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{0}</span><span class="s1">, </span><span class="si">{1}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ra</span><span class="p">,</span> <span class="n">dec</span><span class="p">)</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">y</span> <span class="o">=</span> <span class="mi">11</span>

<span class="c1"># set local file path to current working directory</span>
<span class="n">path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">curdir</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p><a id="download_tesscut"></a></p>
<section id="use-astroquery-to-retrieve-the-tesscut-image">
<h3>Use Astroquery to retrieve the TESSCut image<a class="headerlink" href="#use-astroquery-to-retrieve-the-tesscut-image" title="Permalink to this headline">#</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">download_cutouts</span></code> method requires as input an Astropy SkyCoord object, a cutout size in pixels and optionally accepts a download path.  This will download the custom cutout into the specified path and returns and Astropy table object with the paths to all the downloaded files.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># create a sky coordinate object</span>
<span class="n">cutout_coords</span> <span class="o">=</span> <span class="n">SkyCoord</span><span class="p">(</span><span class="n">ra</span><span class="p">,</span> <span class="n">dec</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="s2">&quot;deg&quot;</span><span class="p">)</span>
    
<span class="c1"># download the files and get the list of local paths</span>
<span class="k">try</span><span class="p">:</span>
    <span class="n">table</span> <span class="o">=</span> <span class="n">Tesscut</span><span class="o">.</span><span class="n">download_cutouts</span><span class="p">(</span><span class="n">cutout_coords</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">x</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="n">path</span><span class="p">)</span>
<span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Error: Could not download cutouts: </span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
<span class="k">else</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">table</span><span class="p">)</span>
    <span class="n">files</span> <span class="o">=</span> <span class="n">table</span><span class="p">[</span><span class="s1">&#39;Local Path&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Error: Could not download cutouts: download_cutouts() takes 1 positional argument but 2 positional arguments (and 2 keyword-only arguments) were given
</pre></div>
</div>
</div>
</div>
<p><a id="make_tpf"></a></p>
</section>
<section id="open-a-target-pixel-file">
<h3>Open a Target Pixel File<a class="headerlink" href="#open-a-target-pixel-file" title="Permalink to this headline">#</a></h3>
<p>We’ll be using Kepler’s <a class="reference external" href="https://barentsen.github.io/k2flix/">k2flix</a> Python package to open and access the file, using the <code class="docutils literal notranslate"><span class="pre">TargetPixelFile</span></code> class.  This is a convenience class that allows use to easily create a GIF.  Kepler provides a range of <a class="reference external" href="https://keplerscience.arc.nasa.gov/software.html">software tools</a> that should also work with TESS data. We instantiate a new object and print some basic information about the custom TPF.  We need the WCS of the new TESS cutout, so we use Astropy WCS to define and create the wcs using the APERTURE extension of the cutout file.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># grab the first file in the list</span>
<span class="n">filename</span> <span class="o">=</span> <span class="n">files</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

<span class="c1"># create the TargetPixelFile instance</span>
<span class="n">tpf</span> <span class="o">=</span> <span class="n">k2flix</span><span class="o">.</span><span class="n">TargetPixelFile</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>

<span class="c1"># get number of pixels in flux array </span>
<span class="n">n_pix</span> <span class="o">=</span> <span class="n">tpf</span><span class="o">.</span><span class="n">flux</span><span class="p">()</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

<span class="c1"># compute field of view in degrees</span>
<span class="n">res</span> <span class="o">=</span> <span class="mf">21.0</span> <span class="o">*</span> <span class="p">(</span><span class="n">u</span><span class="o">.</span><span class="n">arcsec</span><span class="o">/</span><span class="n">u</span><span class="o">.</span><span class="n">pixel</span><span class="p">)</span>
<span class="n">area</span> <span class="o">=</span> <span class="n">res</span> <span class="o">*</span> <span class="p">(</span><span class="n">n_pix</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">pixel</span><span class="p">)</span>
<span class="n">d</span> <span class="o">=</span> <span class="n">area</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">u</span><span class="o">.</span><span class="n">degree</span><span class="p">)</span>
<span class="n">fov</span> <span class="o">=</span> <span class="n">d</span><span class="o">.</span><span class="n">value</span> 

<span class="c1"># compute the wcs of the image</span>
<span class="n">wcs</span> <span class="o">=</span> <span class="n">WCS</span><span class="p">(</span><span class="n">tpf</span><span class="o">.</span><span class="n">hdulist</span><span class="p">[</span><span class="s1">&#39;APERTURE&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">header</span><span class="p">)</span>

<span class="c1"># print some info</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;filename&#39;</span><span class="p">,</span> <span class="n">tpf</span><span class="o">.</span><span class="n">filename</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Target TPF&#39;</span><span class="p">,</span> <span class="n">target</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Field of View [degrees]&#39;</span><span class="p">,</span> <span class="n">fov</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Number pixels&#39;</span><span class="p">,</span> <span class="n">tpf</span><span class="o">.</span><span class="n">flux</span><span class="p">()</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span> <span class="p">[</span><span class="mi">4</span><span class="p">],</span> <span class="n">line</span> <span class="mi">2</span>
<span class="g g-Whitespace">      </span><span class="mi">1</span> <span class="c1"># grab the first file in the list</span>
<span class="ne">----&gt; </span><span class="mi">2</span> <span class="n">filename</span> <span class="o">=</span> <span class="n">files</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="g g-Whitespace">      </span><span class="mi">4</span> <span class="c1"># create the TargetPixelFile instance</span>
<span class="g g-Whitespace">      </span><span class="mi">5</span> <span class="n">tpf</span> <span class="o">=</span> <span class="n">k2flix</span><span class="o">.</span><span class="n">TargetPixelFile</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>

<span class="ne">NameError</span>: name &#39;files&#39; is not defined
</pre></div>
</div>
</div>
</div>
<p><a id="make_gif"></a></p>
</section>
<section id="create-and-display-a-gif-of-the-custom-tpf">
<h3>Create and display a GIF of the custom TPF<a class="headerlink" href="#create-and-display-a-gif-of-the-custom-tpf" title="Permalink to this headline">#</a></h3>
<p>Using k2flix and the TPF instance, we can create a GIF of the time-series data in the cutout with the <code class="docutils literal notranslate"><span class="pre">save_movie</span></code> method.  Once it’s generated, we use the IPython Image class to display the gif in the notebook cell.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># create the gif</span>
<span class="n">gif</span> <span class="o">=</span> <span class="n">tpf</span><span class="o">.</span><span class="n">filename</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;.fits&#39;</span><span class="p">,</span> <span class="s1">&#39;.gif&#39;</span><span class="p">)</span>
<span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">gif</span><span class="p">):</span>
    <span class="n">tpf</span><span class="o">.</span><span class="n">save_movie</span><span class="p">(</span><span class="n">gif</span><span class="p">,</span> <span class="n">show_flags</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># display the gif</span>
<span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">gif</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;No gif found. Cannot display gif of time-series.&quot;</span><span class="p">)</span>

<span class="n">Image</span><span class="p">(</span><span class="n">gif</span><span class="p">,</span> <span class="n">embed</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p><a id="find_tic"></a></p>
</section>
<section id="find-targets-within-tpf-fov-in-tess-input-catalog">
<h3>Find targets within TPF FOV in TESS Input Catalog<a class="headerlink" href="#find-targets-within-tpf-fov-in-tess-input-catalog" title="Permalink to this headline">#</a></h3>
<p>We also want to retrieve all objects from the TESS Input Catalog that are within the custom TESS cutout field of view.  We can use <strong>Astroquery</strong> <a class="reference external" href="https://astroquery.readthedocs.io/en/latest/mast/mast.html#catalog-queries">Catalogs.query_region</a> to do this.  This takes a string input of RA, Dec, and a search radius in degrees, and which catalog to search on.  Since our fov is the total width/height of the cutout, we use <code class="docutils literal notranslate"><span class="pre">fov/2.</span></code> to get a radius.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">catalogData</span> <span class="o">=</span> <span class="n">Catalogs</span><span class="o">.</span><span class="n">query_region</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="n">radius</span><span class="o">=</span><span class="n">fov</span><span class="o">/</span><span class="mf">2.</span><span class="p">,</span> <span class="n">catalog</span><span class="o">=</span><span class="s2">&quot;Tic&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;n_targets&#39;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">catalogData</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;example rows:</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">catalogData</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">5</span><span class="p">][</span><span class="s1">&#39;ID&#39;</span><span class="p">,</span> <span class="s1">&#39;ra&#39;</span><span class="p">,</span> <span class="s1">&#39;dec&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<p><a id="plot_tpf_tic"></a></p>
</section>
<section id="plot-static-tpf-image-and-overlay-tic-catalog">
<h3>Plot static TPF image and overlay TIC catalog<a class="headerlink" href="#plot-static-tpf-image-and-overlay-tic-catalog" title="Permalink to this headline">#</a></h3>
<p>Let’s overylay the catalog search results with the custom TESS cutout.  We first need to convert the RA, Dec of all the catalog objects into pixel coordinates on the TESS cutout image.  We can do this using the <a class="reference external" href="http://docs.astropy.org/en/stable/wcs/">Astropy WCS</a> object, with the <code class="docutils literal notranslate"><span class="pre">all_world2pix</span></code> method.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># get RA and Dec coords of catalog data</span>
<span class="n">tic_ra</span> <span class="o">=</span> <span class="n">catalogData</span><span class="p">[</span><span class="s1">&#39;ra&#39;</span><span class="p">]</span>
<span class="n">tic_dec</span> <span class="o">=</span> <span class="n">catalogData</span><span class="p">[</span><span class="s1">&#39;dec&#39;</span><span class="p">]</span>

<span class="c1"># get pixel coordinates of RA and Dec </span>
<span class="n">coords</span> <span class="o">=</span> <span class="n">wcs</span><span class="o">.</span><span class="n">all_world2pix</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">tic_ra</span><span class="p">,</span> <span class="n">tic_dec</span><span class="p">)),</span><span class="mi">0</span><span class="p">)</span>
<span class="n">xc</span> <span class="o">=</span> <span class="p">[</span><span class="n">c</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">coords</span><span class="p">]</span>
<span class="n">yc</span> <span class="o">=</span> <span class="p">[</span><span class="n">c</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">coords</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<p>Let’s use matplotlib to plot the first frame in the time-series of the cutout.  We use <code class="docutils literal notranslate"><span class="pre">matplotlib.pyplot.imshow</span></code>.  Now that we have the catalog object positions in pixel coordinates, we can overlay them as a scatter plot with <code class="docutils literal notranslate"><span class="pre">matplotlib.pyplot.scatter</span></code>.  We’ve optionally included a <code class="docutils literal notranslate"><span class="pre">use_wcs</span></code> flag to create the plot using the WCS.  See <a class="reference external" href="http://docs.astropy.org/en/stable/wcs/#matplotlib-plots-with-correct-wcs-projection">Matplotlib Plots With WCS</a> for more details.  We can pass a WCS object as a matplotlib axis projection.  Try setting <code class="docutils literal notranslate"><span class="pre">use_wcs</span> <span class="pre">=</span> <span class="pre">True</span></code>.  This will create the plot using the World Coordinates as the x,y axes.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># get first frame of flux from TPF</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">tpf</span><span class="o">.</span><span class="n">hdulist</span><span class="p">[</span><span class="s1">&#39;PIXELS&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;FLUX&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">,:,:]</span>

<span class="c1"># use log image normalization</span>
<span class="n">norm</span> <span class="o">=</span> <span class="n">simple_norm</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="s1">&#39;log&#39;</span><span class="p">)</span>

<span class="c1"># plot with wcs or not</span>
<span class="n">use_wcs</span> <span class="o">=</span> <span class="kc">False</span>

<span class="c1"># plot image and overlay TIC points</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="n">projection</span><span class="o">=</span><span class="n">wcs</span> <span class="k">if</span> <span class="n">use_wcs</span> <span class="k">else</span> <span class="kc">None</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="s1">&#39;lower&#39;</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="n">norm</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">)</span>
<span class="c1">#ax.scatter(tic_ra, tic_dec, transform=ax.get_transform(&#39;world&#39;), s=20, facecolor=&#39;red&#39;, edgecolor=&#39;white&#39;)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">xc</span><span class="p">,</span> <span class="n">yc</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">)</span>


<span class="n">ax</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">set_size_inches</span><span class="p">((</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">))</span>

<span class="c1"># deal with axes</span>
<span class="k">if</span> <span class="n">use_wcs</span><span class="p">:</span>
    <span class="n">xax</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">coords</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">yax</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">coords</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">xax</span><span class="o">.</span><span class="n">set_ticks</span><span class="p">(</span><span class="n">spacing</span><span class="o">=</span><span class="mf">1.</span><span class="o">*</span><span class="n">u</span><span class="o">.</span><span class="n">arcmin</span><span class="p">)</span>
    <span class="n">yax</span><span class="o">.</span><span class="n">set_ticks</span><span class="p">(</span><span class="n">spacing</span><span class="o">=</span><span class="mf">0.5</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">arcmin</span><span class="p">)</span>
    <span class="n">xax</span><span class="o">.</span><span class="n">set_axislabel</span><span class="p">(</span><span class="s1">&#39;Right Ascension&#39;</span><span class="p">)</span>
    <span class="n">yax</span><span class="o">.</span><span class="n">set_axislabel</span><span class="p">(</span><span class="s1">&#39;Declination&#39;</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;x pixel&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;y pixel&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>The TESS FFI images currently have an issue with its WCS that shift transformations by ~1 pixel.  To illustrate this point, we’ll compare the TESS cutout overlay with the TIC objects in pixel coordinates and world coordinates.  The left panel plots the cutout with the correct overlay of TIC objects.  The right panel plots the cutout using its WCS transformation.  The TIC objects are shifted by about a pixel relative to the underlying cutout.  This issue will present itself when using the WCS to overlay the cutout onto other data or vice versa.  The underlying cause of this issue is still being explored.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Pixel plot</span>
<span class="n">ax1</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="s1">&#39;lower&#39;</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="n">norm</span><span class="p">,</span>  <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">xc</span><span class="p">,</span> <span class="n">yc</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;y&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;TessCut-Pixel&#39;</span><span class="p">)</span>

<span class="c1"># WCS plot</span>
<span class="n">ax2</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span> <span class="n">projection</span><span class="o">=</span><span class="n">wcs</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="s1">&#39;lower&#39;</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="n">norm</span><span class="p">,</span>  <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">coords</span><span class="p">[</span><span class="s1">&#39;ra&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_axislabel</span><span class="p">(</span><span class="s1">&#39;Right Ascension&#39;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">coords</span><span class="p">[</span><span class="s1">&#39;dec&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_axislabel</span><span class="p">(</span><span class="s1">&#39;Declination&#39;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">tic_ra</span><span class="p">,</span> <span class="n">tic_dec</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">ax2</span><span class="o">.</span><span class="n">get_transform</span><span class="p">(</span><span class="s1">&#39;world&#39;</span><span class="p">),</span> <span class="n">s</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;TessCut-WCS&#39;</span><span class="p">)</span>

<span class="n">ax1</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">set_size_inches</span><span class="p">((</span><span class="mi">15</span><span class="p">,</span><span class="mi">15</span><span class="p">))</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">set_size_inches</span><span class="p">((</span><span class="mi">15</span><span class="p">,</span><span class="mi">15</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<p><a id="get_dss"></a></p>
</section>
</section>
<section id="retrieve-the-dss-image-of-the-region">
<h2>Retrieve the DSS image of the region<a class="headerlink" href="#retrieve-the-dss-image-of-the-region" title="Permalink to this headline">#</a></h2>
<p>To overlay the TESSCut image against the DSS image, we need to query the STScI DSS Cutout Image service.  First we define a custom function, <code class="docutils literal notranslate"><span class="pre">getdss</span></code>, to perform call.  This performs a basic http GET request to the given url and retrieves a DSS image cutout given some input parameters.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">url</span> <span class="o">=</span> <span class="s2">&quot;https://archive.stsci.edu/cgi-bin/dss_search&quot;</span>
<span class="n">plateDict</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;red&quot;</span><span class="p">:</span> <span class="s2">&quot;2r&quot;</span><span class="p">,</span> 
             <span class="s2">&quot;blue&quot;</span><span class="p">:</span> <span class="s2">&quot;2b&quot;</span><span class="p">,</span> 
             <span class="s2">&quot;ukred&quot;</span><span class="p">:</span> <span class="s2">&quot;poss2ukstu_red&quot;</span><span class="p">,</span> 
             <span class="s2">&quot;ukblue&quot;</span><span class="p">:</span> <span class="s2">&quot;poss2ukstu_blue&quot;</span><span class="p">}</span>

<span class="k">def</span> <span class="nf">getdss</span><span class="p">(</span><span class="n">ra</span><span class="p">,</span> <span class="n">dec</span><span class="p">,</span> <span class="n">plate</span><span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> 
           <span class="n">filename</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">directory</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot;Extract DSS image at position and write a FITS file</span>
<span class="sd">    </span>
<span class="sd">    ra, dec are J2000 coordinates in degrees</span>
<span class="sd">    plate can be &quot;red&quot;, &quot;blue&quot;, &quot;ukred&quot;, or &quot;ukblue&quot;</span>
<span class="sd">    height and width are in arcmin, default = 7.0.  Image is square if only one is specified.</span>
<span class="sd">    filename specifies name for output file (default=&quot;dss_{plate}_{ra}_{dec}.fits&quot;)</span>
<span class="sd">    directory is location for output file (default is current directory)</span>
<span class="sd">    </span>
<span class="sd">    Returns the name of the file that was written</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># set defaults for height &amp; width</span>
    <span class="k">if</span> <span class="n">height</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">width</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">height</span> <span class="o">=</span> <span class="n">width</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">height</span> <span class="o">=</span> <span class="mf">7.0</span>
            <span class="n">width</span> <span class="o">=</span> <span class="mf">7.0</span>
    <span class="k">elif</span> <span class="n">width</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">width</span> <span class="o">=</span> <span class="n">height</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">vplate</span> <span class="o">=</span> <span class="n">plateDict</span><span class="p">[</span><span class="n">plate</span><span class="p">]</span>
    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Illegal plate value &#39;</span><span class="si">{}</span><span class="s2">&#39;</span><span class="se">\n</span><span class="s2">Should be one of </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="n">plate</span><span class="p">,</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">plateDict</span><span class="o">.</span><span class="n">keys</span><span class="p">())))</span>

    <span class="c1"># construct filename</span>
    <span class="k">if</span> <span class="n">filename</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">filename</span> <span class="o">=</span> <span class="s2">&quot;dss_</span><span class="si">{}</span><span class="s2">_</span><span class="si">{:.6f}</span><span class="s2">_</span><span class="si">{:.6f}</span><span class="s2">.fits&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">plate</span><span class="p">,</span><span class="n">ra</span><span class="p">,</span><span class="n">dec</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">directory</span><span class="p">:</span>
        <span class="n">filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">directory</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>

    <span class="n">params</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;r&quot;</span><span class="p">:</span> <span class="n">ra</span><span class="p">,</span>
            <span class="s2">&quot;d&quot;</span><span class="p">:</span> <span class="n">dec</span><span class="p">,</span>
            <span class="s2">&quot;v&quot;</span><span class="p">:</span> <span class="n">vplate</span><span class="p">,</span>
            <span class="s2">&quot;e&quot;</span><span class="p">:</span> <span class="s2">&quot;J2000&quot;</span><span class="p">,</span>
            <span class="s2">&quot;h&quot;</span><span class="p">:</span> <span class="n">height</span><span class="p">,</span>
            <span class="s2">&quot;w&quot;</span><span class="p">:</span> <span class="n">width</span><span class="p">,</span>
            <span class="s2">&quot;f&quot;</span><span class="p">:</span><span class="s2">&quot;fits&quot;</span><span class="p">,</span>
            <span class="s2">&quot;c&quot;</span><span class="p">:</span><span class="s2">&quot;none&quot;</span><span class="p">,</span>
            <span class="s2">&quot;s&quot;</span><span class="p">:</span> <span class="s2">&quot;yes&quot;</span><span class="p">}</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="n">params</span><span class="p">)</span>

    <span class="c1"># read and format the output</span>
    <span class="n">value</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">content</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">r</span><span class="o">.</span><span class="n">content</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="sa">b</span><span class="s2">&quot;SIMPLE  =&quot;</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;No FITS file returned for </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">filename</span><span class="p">))</span>
    <span class="n">fhout</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s2">&quot;wb&quot;</span><span class="p">)</span>
    <span class="n">fhout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
    <span class="n">fhout</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">filename</span>
</pre></div>
</div>
</div>
</div>
<p>We pass in our target RA and Dec, along with the desired image size in arcminutes, and an optional download path.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># compute the pixel area in arcmin</span>
<span class="n">arcmin</span> <span class="o">=</span> <span class="n">area</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">u</span><span class="o">.</span><span class="n">arcmin</span><span class="p">)</span><span class="o">.</span><span class="n">value</span>

<span class="c1"># retrieve the DSS file</span>
<span class="n">filename</span> <span class="o">=</span> <span class="n">getdss</span><span class="p">(</span><span class="n">ra</span><span class="p">,</span> <span class="n">dec</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="n">arcmin</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="n">arcmin</span><span class="p">,</span> <span class="n">directory</span><span class="o">=</span><span class="n">path</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;DSS Image:&#39;</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Let’s display the DSS image and overlay the TIC catalog objects as a sanity check.  We use the same matplotlib plotting methods as before.  As before, this uses <a class="reference external" href="http://docs.astropy.org/en/stable/visualization/wcsaxes/index.html#wcsaxes">WCSAxes</a> from Astropy to create a plot with correct WCS and overlay coordinate objects.  This time we create a DSS WCS object and use that when creating the plot.  We can also directly pass into a coordinate list of RA, Dec and transform the coordinates into the proper pixels using the DSS WCS.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dss</span> <span class="o">=</span> <span class="n">fits</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>

<span class="c1"># get the data and WCS for the DSS image</span>
<span class="n">dss_data</span> <span class="o">=</span> <span class="n">dss</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">data</span>
<span class="n">dss_wcs</span> <span class="o">=</span> <span class="n">WCS</span><span class="p">(</span><span class="n">dss</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">header</span><span class="p">)</span>

<span class="c1"># display the DSS image and overlay the TIC objects</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="n">projection</span><span class="o">=</span><span class="n">dss_wcs</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">dss_data</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="s1">&#39;lower&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">tic_ra</span><span class="p">,</span> <span class="n">tic_dec</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">get_transform</span><span class="p">(</span><span class="s1">&#39;world&#39;</span><span class="p">),</span> <span class="n">s</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">set_size_inches</span><span class="p">((</span><span class="mi">8</span><span class="p">,</span><span class="mi">8</span><span class="p">))</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Right Ascension&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Declination&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p><a id="overlay_images"></a></p>
</section>
<section id="overlay-the-tesscut-image">
<h2>Overlay the TessCut Image<a class="headerlink" href="#overlay-the-tesscut-image" title="Permalink to this headline">#</a></h2>
<p>To overlay the TESS Cutout against the DSS, we need to reproject the WCS of the TESS cutout onto the WCS of the DSS image, and the <a class="reference external" href="https://reproject.readthedocs.io/en/stable/index.html">reproject</a> package.  We use the <a class="reference external" href="https://reproject.readthedocs.io/en/stable/api/reproject.reproject_interp.html#reproject.reproject_interp">reproject_interp</a> method.  See <a class="reference external" href="https://reproject.readthedocs.io/en/stable/celestial.html">here</a> for more details.</p>
<p><code class="docutils literal notranslate"><span class="pre">reproject_interp</span></code> takes two basic inputs.</p>
<ul class="simple">
<li><p>input data+WCS we want to project from</p></li>
<li><p>output WCS we want to project onto.</p></li>
</ul>
<p>We want to project our TESS cutout and its WCS into the coordinate frame of the DSS image, using the DSS WCS.  Our input is a tuple of the custom TESS cutout data and wcs, i.e. <code class="docutils literal notranslate"><span class="pre">(data,</span> <span class="pre">wcs)</span></code>.  The desired coordinate frame is the WCS we want to project onto, i.e. <code class="docutils literal notranslate"><span class="pre">dss_wcs</span></code>.  We also need to provide the shape of the DSS data, with <code class="docutils literal notranslate"><span class="pre">shape_out</span></code>.  Finally we need to provide an interpolation method.  We use a <code class="docutils literal notranslate"><span class="pre">nearest-neighbor</span></code> interpolation, which is the lowest order possible.</p>
<p><code class="docutils literal notranslate"><span class="pre">reproject_interp</span></code> will take the input 11x11 pixel TESS cutout data, convert it to world coordinates using the TESS WCS, interpolate it into the shape of the DSS image (229x229) using the DSS WCS, and convert the data into DSS pixel coordinates.</p>
<p>The final output is the reprojected TESS cutout data (<code class="docutils literal notranslate"><span class="pre">reproj_tesscut</span></code>) and the overlapping footprint of the input data in the output data (<code class="docutils literal notranslate"><span class="pre">footprint</span></code>).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># reproject the tesscut onto dss</span>
<span class="n">reproj_tesscut</span><span class="p">,</span> <span class="n">footprint</span> <span class="o">=</span> <span class="n">reproject_interp</span><span class="p">((</span><span class="n">data</span><span class="p">,</span> <span class="n">wcs</span><span class="p">,),</span> <span class="n">dss_wcs</span><span class="p">,</span> <span class="n">shape_out</span><span class="o">=</span><span class="n">dss_data</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="s1">&#39;nearest-neighbor&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Once reprojected, we can properly overly the DSS and TESSCut images.  We can add a slider for the opacity of the overlay using ipywidgets.  First we make a <code class="docutils literal notranslate"><span class="pre">create_plot</span></code> function which accepts all the inputs we need to display the DSS image, and overlay the TESS cutout image and TIC objects.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># create the function to overlay dss + tesscut + tic catalog</span>
<span class="k">def</span> <span class="nf">create_plot</span><span class="p">(</span><span class="n">background_img</span><span class="p">,</span> <span class="n">foreground_img</span><span class="p">,</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">norm</span><span class="p">,</span> <span class="n">wcs</span><span class="p">,</span> <span class="n">ra</span><span class="p">,</span> <span class="n">dec</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39; create an interactive matplotlib image plot</span>
<span class="sd">    </span>
<span class="sd">    Parameters:</span>
<span class="sd">        background_img (ndarray):</span>
<span class="sd">            The background image data to show</span>
<span class="sd">        foreground_img (ndarray):</span>
<span class="sd">            The foreground image data to overplot. </span>
<span class="sd">        alpha (tuple):</span>
<span class="sd">            A tuple of min, max for the interactive slider.  </span>
<span class="sd">        norm:</span>
<span class="sd">            The image normalization to use for the overlaid image.</span>
<span class="sd">        wcs (astropy.wcs.wcs.WCS):</span>
<span class="sd">            The WCS of the background image</span>
<span class="sd">        ra (list):</span>
<span class="sd">            A list of RA coordinate objects</span>
<span class="sd">        dec (list):</span>
<span class="sd">            A list of Dec coordinate objects</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="c1"># create plot</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="n">projection</span><span class="o">=</span><span class="n">wcs</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">set_size_inches</span><span class="p">((</span><span class="mi">8</span><span class="p">,</span><span class="mi">8</span><span class="p">))</span>

    <span class="c1"># show image 1</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">background_img</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="s1">&#39;lower&#39;</span><span class="p">)</span>

    <span class="c1"># overlay image 2</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">foreground_img</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="s1">&#39;lower&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="n">norm</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">)</span>

    <span class="c1"># overlay a list of objects</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">ra</span><span class="p">,</span> <span class="n">dec</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">get_transform</span><span class="p">(</span><span class="s1">&#39;world&#39;</span><span class="p">),</span> <span class="n">s</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">)</span>

    <span class="c1"># add axis labels</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Right Ascension&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Declination&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>We use ipywidgets to create an interactive slider widget for the alpha/opacity of the TESS cutout image.  We use the <a class="reference external" href="https://ipywidgets.readthedocs.io/en/stable/examples/Using%20Interact.html#interactive">interactive</a> function to produce an interactive widget.  It takes as input the main function we want to make interactive, in our case, <code class="docutils literal notranslate"><span class="pre">create_plot</span></code>.  You also need to pass in all the inputs to your custom function.</p>
<p>To create a slider for alpha we pass in a tuple of <strong>(min, max)</strong> representing the minimum and maximum slider ranges.  All other inputs to our <code class="docutils literal notranslate"><span class="pre">create_plot</span></code> function should be fixed.  We do not want interaction on these elements.  So we wrap all other inputs in the <a class="reference external" href="https://ipywidgets.readthedocs.io/en/stable/examples/Using%20Interact.html#Fixing-arguments-using-fixed">fixed</a> function from <code class="docutils literal notranslate"><span class="pre">ipywidgets</span></code>.  This tells ipywidgets to use fix those inputs.</p>
<p>Our input background data is the DSS image data, <code class="docutils literal notranslate"><span class="pre">dss_data</span></code>.  The input image to overlay on top is the reprojected TESS data, <code class="docutils literal notranslate"><span class="pre">reproj_tesscut</span></code>.  We also pass in <code class="docutils literal notranslate"><span class="pre">norm</span></code>, the TESS cutout image normalization from before, as well as DSS wcs (<code class="docutils literal notranslate"><span class="pre">dss_wcs</span></code>), and the list of RA and Dec of the TIC objects, <code class="docutils literal notranslate"><span class="pre">tic_ra,</span> <span class="pre">tic_dec</span></code>.</p>
<p>Try moving the slider back and forth to control the opacity of the TESS cutout image against the DSS image.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># create an interactive ipywidget plot for the opacity of tesscut</span>
<span class="n">interactive_plot</span> <span class="o">=</span> <span class="n">interactive</span><span class="p">(</span><span class="n">create_plot</span><span class="p">,</span> <span class="n">background_img</span><span class="o">=</span><span class="n">fixed</span><span class="p">(</span><span class="n">dss_data</span><span class="p">),</span> <span class="n">foreground_img</span><span class="o">=</span><span class="n">fixed</span><span class="p">(</span><span class="n">reproj_tesscut</span><span class="p">),</span> 
                               <span class="n">alpha</span><span class="o">=</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">1.0</span><span class="p">),</span> <span class="n">norm</span><span class="o">=</span><span class="n">fixed</span><span class="p">(</span><span class="n">norm</span><span class="p">),</span> <span class="n">wcs</span><span class="o">=</span><span class="n">fixed</span><span class="p">(</span><span class="n">dss_wcs</span><span class="p">),</span> 
                               <span class="n">ra</span><span class="o">=</span><span class="n">fixed</span><span class="p">(</span><span class="n">tic_ra</span><span class="p">),</span> <span class="n">dec</span><span class="o">=</span><span class="n">fixed</span><span class="p">(</span><span class="n">tic_dec</span><span class="p">))</span>
<span class="c1"># display the plot</span>
<span class="n">output</span> <span class="o">=</span> <span class="n">interactive_plot</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<span class="n">output</span><span class="o">.</span><span class="n">layout</span><span class="o">.</span><span class="n">height</span> <span class="o">=</span> <span class="s1">&#39;500px&#39;</span>
<span class="n">interactive_plot</span>
</pre></div>
</div>
</div>
</div>
<p><a id="resources"></a></p>
</section>
<section id="additional-resources">
<h2>Additional Resources<a class="headerlink" href="#additional-resources" title="Permalink to this headline">#</a></h2>
<p><a class="reference external" href="https://mast.stsci.edu/tesscut/">TESScut API Documentation</a><br>
<a class="reference external" href="https://astrocut.readthedocs.io/en/latest/">Astrocut Documentation</a><br>
<a class="reference external" href="https://archive.stsci.edu/tess">TESS Homepage</a><br>
<a class="reference external" href="https://outerspace.stsci.edu/display/TESS/TESS+Archive+Manual">TESS Archive Manual</a></p>
<p><a id="about_ID"></a></p>
</section>
<section id="about-this-notebook">
<h2>About this Notebook<a class="headerlink" href="#about-this-notebook" title="Permalink to this headline">#</a></h2>
<p><strong>Author:</strong> Brian Cherinka, STScI Archive Scientist
<br><strong>Updated On:</strong> 2019-01-28</p>
<p><a class="reference external" href="#title_ID">Top of Page</a>
<img style="float: right;" src="https://raw.githubusercontent.com/spacetelescope/notebooks/master/assets/stsci_pri_combo_mark_horizonal_white_bkgd.png" alt="STScI logo" width="200px"/></p>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "None/None",
            ref: "main",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./notebooks/MAST/TESS/interm_tesscut_dss_overlay"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
            </main>
            <footer class="footer-article noprint">
                
    <!-- Previous / next buttons -->
<div class='prev-next-area'>
    <a class='left-prev' id="prev-link" href="../beginner_tess_tap_search/beginner_tess_tap_search.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">Download MAST TESS Light Curves Within an FFI Footprint Using TAP</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="../interm_tess_prf_retrieve/interm_tess_prf_retrieve.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Intermediate: Retrieve TESS Pixel Response Function Images</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
            </footer>
        </div>
    </div>
    <div class="footer-content row">
        <footer class="col footer"><p>
  
    By STScI<br/>
  
      &copy; Copyright 2022.<br/>
</p>
        </footer>
    </div>
    
</div>


      </div>
    </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../../../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf"></script>


  </body>
</html>